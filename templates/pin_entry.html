<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Enter PIN</title>
  <link rel="stylesheet" href="/static/style.css">
  <link rel="manifest" href="/static/manifest.json">
<meta name="theme-color" content="#0ff">
<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/static/sw.js')
      .then(() => console.log('Service Worker registered'))
      .catch(err => console.error('SW registration failed:', err));
  }
</script>
</head>
<body>
  <div class="pin-container">
    <div id="display">----</div>
    <div id="keypad"></div>

    <form id="pinForm" method="POST" action="/submit_pin">
      <input type="hidden" name="pin" id="hiddenPin">
    </form>

    {% if error %}
      <p style="color:red">{{ error }}</p>
    {% endif %}
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const display = document.getElementById("display");
      const keypad = document.getElementById("keypad");
      const hiddenPin = document.getElementById("hiddenPin");
      const form = document.getElementById("pinForm");

      const keys = ['1','2','3','4','5','6','7','8','9','0','⌫','C'];
      keys.forEach(k => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.textContent = k;

        // Backspace & Clear in red
        if(k === '⌫' || k === 'C') btn.classList.add("red");

        btn.onclick = () => {
          let current = display.textContent.replace(/-/g,'');
          if(k === 'C') {
            current = '';
          } else if(k === '⌫') {
            current = current.slice(0, -1);
          } else if(current.length < 4) {
            current += k;
          }

          display.textContent = current.padEnd(4,'-');
          hiddenPin.value = current;

          // Auto-submit on 4 digits
          if(current.length === 4) form.submit();
        };
        keypad.appendChild(btn);
      });
    });
  </script>
</body>
</html>
